{"ast":null,"code":"import React,{useEffect,useRef,useContext}from\"react\";import classNames from\"classnames\";import{Vector2,sRGBEncoding,WebGLRenderer,PerspectiveCamera,Scene,DirectionalLight,AmbientLight,UniformsUtils,UniformsLib,MeshPhongMaterial,SphereBufferGeometry,Mesh}from\"three\";import{spring,value}from\"popmotion\";import innerHeight from\"ios-inner-height\";import vertShader from\"./sphereVertShader\";import fragShader from\"./sphereFragShader\";import{Transition}from\"react-transition-group\";import{usePrefersReducedMotion}from\"../../hooks/usePrefersReducedMotion\";import{useInViewport}from\"../../hooks/useInViewport\";import{reflow}from\"../../utils/transition\";import{media,rgbToThreeColor}from\"../../utils/style\";import{cleanScene,removeLights,cleanRenderer}from\"../../utils/three\";import\"./DisplacementSphere.css\";import{ThemeContext}from\"../theme/ThemeProvider\";var DisplacementSphere=function DisplacementSphere(props){var _useContext=useContext(ThemeContext),theme=_useContext.theme;var rgbBackground=theme===\"light\"?\"250 250 250\":\"17 17 17\";var width=useRef(window.innerWidth);var height=useRef(window.innerHeight);var start=useRef(Date.now());var canvasRef=useRef();var mouse=useRef();var renderer=useRef();var camera=useRef();var scene=useRef();var lights=useRef();var uniforms=useRef();var material=useRef();var geometry=useRef();var sphere=useRef();var tweenRef=useRef();var sphereSpring=useRef();var prefersReducedMotion=Boolean(usePrefersReducedMotion()&&false);//disabled until switching themes fixed\nvar isInViewport=useInViewport(canvasRef);useEffect(function(){mouse.current=new Vector2(0.8,0.5);renderer.current=new WebGLRenderer({canvas:canvasRef.current,powerPreference:\"high-performance\"});renderer.current.setSize(width.current,height.current);renderer.current.setPixelRatio(1);renderer.current.outputEncoding=sRGBEncoding;camera.current=new PerspectiveCamera(55,width.current/height.current,0.1,200);camera.current.position.z=52;scene.current=new Scene();material.current=new MeshPhongMaterial();material.current.onBeforeCompile=function(shader){uniforms.current=UniformsUtils.merge([UniformsLib[\"ambient\"],UniformsLib[\"lights\"],shader.uniforms,{time:{type:\"f\",value:0}}]);shader.uniforms=uniforms.current;shader.vertexShader=vertShader;shader.fragmentShader=fragShader;shader.lights=true;};geometry.current=new SphereBufferGeometry(32,128,128);sphere.current=new Mesh(geometry.current,material.current);sphere.current.position.z=0;sphere.current.modifier=Math.random();scene.current.add(sphere.current);return function(){cleanScene(scene.current);cleanRenderer(renderer.current);};},[]);useEffect(function(){var dirLight=new DirectionalLight(rgbToThreeColor(\"250 250 250\"),0.6);var ambientLight=new AmbientLight(rgbToThreeColor(\"250 250 250\"),theme===\"light\"?0.8:0.1);dirLight.position.z=200;dirLight.position.x=100;dirLight.position.y=100;lights.current=[dirLight,ambientLight];scene.current.background=rgbToThreeColor(rgbBackground);lights.current.forEach(function(light){return scene.current.add(light);});return function(){removeLights(lights.current);};},[rgbBackground,theme]);useEffect(function(){var handleResize=function handleResize(){var canvasHeight=innerHeight();var windowWidth=window.innerWidth;var fullHeight=canvasHeight+canvasHeight*0.3;canvasRef.current.style.height=fullHeight;renderer.current.setSize(windowWidth,fullHeight);camera.current.aspect=windowWidth/fullHeight;camera.current.updateProjectionMatrix();// Render a single frame on resize when not animating\nif(prefersReducedMotion){renderer.current.render(scene.current,camera.current);}if(windowWidth<=media.mobile){sphere.current.position.x=14;sphere.current.position.y=10;}else if(windowWidth<=media.tablet){sphere.current.position.x=18;sphere.current.position.y=14;}else{sphere.current.position.x=22;sphere.current.position.y=16;}};window.addEventListener(\"resize\",handleResize);handleResize();return function(){window.removeEventListener(\"resize\",handleResize);};},[prefersReducedMotion]);useEffect(function(){var onMouseMove=function onMouseMove(event){var rotation=sphere.current.rotation;var position={x:event.clientX/window.innerWidth,y:event.clientY/window.innerHeight};if(!sphereSpring.current){sphereSpring.current=value(rotation.toArray(),function(values){return rotation.set(values[0],values[1],sphere.current.rotation.z);});}tweenRef.current=spring({from:sphereSpring.current.get(),to:[position.y/2,position.x/2],stiffness:30,damping:20,velocity:sphereSpring.current.getVelocity(),mass:2,restSpeed:0.0001}).start(sphereSpring.current);};if(!prefersReducedMotion&&isInViewport){window.addEventListener(\"mousemove\",onMouseMove);}return function(){window.removeEventListener(\"mousemove\",onMouseMove);if(tweenRef.current){tweenRef.current.stop();}};},[isInViewport,prefersReducedMotion]);useEffect(function(){var animation;var animate=function animate(){animation=requestAnimationFrame(animate);if(uniforms.current!==undefined){uniforms.current.time.value=0.00005*(Date.now()-start.current);}sphere.current.rotation.z+=0.001;renderer.current.render(scene.current,camera.current);};if(!prefersReducedMotion&&isInViewport){animate();}else{renderer.current.render(scene.current,camera.current);}return function(){cancelAnimationFrame(animation);};},[isInViewport,prefersReducedMotion]);return/*#__PURE__*/React.createElement(Transition,{appear:true,in:true,onEnter:reflow,timeout:3000},function(status){return/*#__PURE__*/React.createElement(\"canvas\",Object.assign({\"aria-hidden\":true,className:classNames(\"displacement-sphere\",\"displacement-sphere--\".concat(status)),ref:canvasRef},props));});};export default DisplacementSphere;","map":{"version":3,"sources":["/home/lucas/Documentos/portfolio/PortfolioLucas/src/components/background/DisplacementSphere.js"],"names":["React","useEffect","useRef","useContext","classNames","Vector2","sRGBEncoding","WebGLRenderer","PerspectiveCamera","Scene","DirectionalLight","AmbientLight","UniformsUtils","UniformsLib","MeshPhongMaterial","SphereBufferGeometry","Mesh","spring","value","innerHeight","vertShader","fragShader","Transition","usePrefersReducedMotion","useInViewport","reflow","media","rgbToThreeColor","cleanScene","removeLights","cleanRenderer","ThemeContext","DisplacementSphere","props","theme","rgbBackground","width","window","innerWidth","height","start","Date","now","canvasRef","mouse","renderer","camera","scene","lights","uniforms","material","geometry","sphere","tweenRef","sphereSpring","prefersReducedMotion","Boolean","isInViewport","current","canvas","powerPreference","setSize","setPixelRatio","outputEncoding","position","z","onBeforeCompile","shader","merge","time","type","vertexShader","fragmentShader","modifier","Math","random","add","dirLight","ambientLight","x","y","background","forEach","light","handleResize","canvasHeight","windowWidth","fullHeight","style","aspect","updateProjectionMatrix","render","mobile","tablet","addEventListener","removeEventListener","onMouseMove","event","rotation","clientX","clientY","toArray","values","set","from","get","to","stiffness","damping","velocity","getVelocity","mass","restSpeed","stop","animation","animate","requestAnimationFrame","undefined","cancelAnimationFrame","status"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useContext } from \"react\";\nimport classNames from \"classnames\";\nimport {\n    Vector2,\n    sRGBEncoding,\n    WebGLRenderer,\n    PerspectiveCamera,\n    Scene,\n    DirectionalLight,\n    AmbientLight,\n    UniformsUtils,\n    UniformsLib,\n    MeshPhongMaterial,\n    SphereBufferGeometry,\n    Mesh,\n} from \"three\";\nimport { spring, value } from \"popmotion\";\nimport innerHeight from \"ios-inner-height\";\nimport vertShader from \"./sphereVertShader\";\nimport fragShader from \"./sphereFragShader\";\nimport { Transition } from \"react-transition-group\";\nimport { usePrefersReducedMotion } from \"../../hooks/usePrefersReducedMotion\";\nimport { useInViewport } from \"../../hooks/useInViewport\";\nimport { reflow } from \"../../utils/transition\";\nimport { media, rgbToThreeColor } from \"../../utils/style\";\nimport { cleanScene, removeLights, cleanRenderer } from \"../../utils/three\";\nimport \"./DisplacementSphere.css\";\nimport { ThemeContext } from \"../theme/ThemeProvider\";\n\nconst DisplacementSphere = (props) => {\n    const { theme } = useContext(ThemeContext);\n    const rgbBackground = theme === \"light\" ? \"250 250 250\" : \"17 17 17\";\n    const width = useRef(window.innerWidth);\n    const height = useRef(window.innerHeight);\n    const start = useRef(Date.now());\n    const canvasRef = useRef();\n    const mouse = useRef();\n    const renderer = useRef();\n    const camera = useRef();\n    const scene = useRef();\n    const lights = useRef();\n    const uniforms = useRef();\n    const material = useRef();\n    const geometry = useRef();\n    const sphere = useRef();\n    const tweenRef = useRef();\n    const sphereSpring = useRef();\n    const prefersReducedMotion = Boolean(usePrefersReducedMotion() && false); //disabled until switching themes fixed\n    const isInViewport = useInViewport(canvasRef);\n\n    useEffect(() => {\n        mouse.current = new Vector2(0.8, 0.5);\n        renderer.current = new WebGLRenderer({\n            canvas: canvasRef.current,\n            powerPreference: \"high-performance\",\n        });\n        renderer.current.setSize(width.current, height.current);\n        renderer.current.setPixelRatio(1);\n        renderer.current.outputEncoding = sRGBEncoding;\n\n        camera.current = new PerspectiveCamera(\n            55,\n            width.current / height.current,\n            0.1,\n            200\n        );\n        camera.current.position.z = 52;\n\n        scene.current = new Scene();\n\n        material.current = new MeshPhongMaterial();\n        material.current.onBeforeCompile = (shader) => {\n            uniforms.current = UniformsUtils.merge([\n                UniformsLib[\"ambient\"],\n                UniformsLib[\"lights\"],\n                shader.uniforms,\n                { time: { type: \"f\", value: 0 } },\n            ]);\n\n            shader.uniforms = uniforms.current;\n            shader.vertexShader = vertShader;\n            shader.fragmentShader = fragShader;\n            shader.lights = true;\n        };\n\n        geometry.current = new SphereBufferGeometry(32, 128, 128);\n\n        sphere.current = new Mesh(geometry.current, material.current);\n        sphere.current.position.z = 0;\n        sphere.current.modifier = Math.random();\n        scene.current.add(sphere.current);\n\n        return () => {\n            cleanScene(scene.current);\n            cleanRenderer(renderer.current);\n        };\n    }, []);\n\n    useEffect(() => {\n        const dirLight = new DirectionalLight(\n            rgbToThreeColor(\"250 250 250\"),\n            0.6\n        );\n        const ambientLight = new AmbientLight(\n            rgbToThreeColor(\"250 250 250\"),\n            theme === \"light\" ? 0.8 : 0.1\n        );\n\n        dirLight.position.z = 200;\n        dirLight.position.x = 100;\n        dirLight.position.y = 100;\n\n        lights.current = [dirLight, ambientLight];\n        scene.current.background = rgbToThreeColor(rgbBackground);\n        lights.current.forEach((light) => scene.current.add(light));\n\n        return () => {\n            removeLights(lights.current);\n        };\n    }, [rgbBackground, theme]);\n\n    useEffect(() => {\n        const handleResize = () => {\n            const canvasHeight = innerHeight();\n            const windowWidth = window.innerWidth;\n            const fullHeight = canvasHeight + canvasHeight * 0.3;\n            canvasRef.current.style.height = fullHeight;\n            renderer.current.setSize(windowWidth, fullHeight);\n            camera.current.aspect = windowWidth / fullHeight;\n            camera.current.updateProjectionMatrix();\n\n            // Render a single frame on resize when not animating\n            if (prefersReducedMotion) {\n                renderer.current.render(scene.current, camera.current);\n            }\n\n            if (windowWidth <= media.mobile) {\n                sphere.current.position.x = 14;\n                sphere.current.position.y = 10;\n            } else if (windowWidth <= media.tablet) {\n                sphere.current.position.x = 18;\n                sphere.current.position.y = 14;\n            } else {\n                sphere.current.position.x = 22;\n                sphere.current.position.y = 16;\n            }\n        };\n\n        window.addEventListener(\"resize\", handleResize);\n        handleResize();\n\n        return () => {\n            window.removeEventListener(\"resize\", handleResize);\n        };\n    }, [prefersReducedMotion]);\n\n    useEffect(() => {\n        const onMouseMove = (event) => {\n            const { rotation } = sphere.current;\n\n            const position = {\n                x: event.clientX / window.innerWidth,\n                y: event.clientY / window.innerHeight,\n            };\n\n            if (!sphereSpring.current) {\n                sphereSpring.current = value(rotation.toArray(), (values) =>\n                    rotation.set(\n                        values[0],\n                        values[1],\n                        sphere.current.rotation.z\n                    )\n                );\n            }\n\n            tweenRef.current = spring({\n                from: sphereSpring.current.get(),\n                to: [position.y / 2, position.x / 2],\n                stiffness: 30,\n                damping: 20,\n                velocity: sphereSpring.current.getVelocity(),\n                mass: 2,\n                restSpeed: 0.0001,\n            }).start(sphereSpring.current);\n        };\n\n        if (!prefersReducedMotion && isInViewport) {\n            window.addEventListener(\"mousemove\", onMouseMove);\n        }\n\n        return () => {\n            window.removeEventListener(\"mousemove\", onMouseMove);\n\n            if (tweenRef.current) {\n                tweenRef.current.stop();\n            }\n        };\n    }, [isInViewport, prefersReducedMotion]);\n\n    useEffect(() => {\n        let animation;\n\n        const animate = () => {\n            animation = requestAnimationFrame(animate);\n\n            if (uniforms.current !== undefined) {\n                uniforms.current.time.value =\n                    0.00005 * (Date.now() - start.current);\n            }\n\n            sphere.current.rotation.z += 0.001;\n            renderer.current.render(scene.current, camera.current);\n        };\n\n        if (!prefersReducedMotion && isInViewport) {\n            animate();\n        } else {\n            renderer.current.render(scene.current, camera.current);\n        }\n\n        return () => {\n            cancelAnimationFrame(animation);\n        };\n    }, [isInViewport, prefersReducedMotion]);\n\n    return (\n        <Transition appear in onEnter={reflow} timeout={3000}>\n            {(status) => (\n                <canvas\n                    aria-hidden\n                    className={classNames(\n                        \"displacement-sphere\",\n                        `displacement-sphere--${status}`\n                    )}\n                    ref={canvasRef}\n                    {...props}\n                />\n            )}\n        </Transition>\n    );\n};\n\nexport default DisplacementSphere;\n"]},"metadata":{},"sourceType":"module"}